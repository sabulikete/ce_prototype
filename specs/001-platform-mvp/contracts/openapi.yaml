openapi: 3.0.0
info:
  title: Member Portal Platform API
  version: 1.0.0
  description: API for Member Portal Platform MVP
servers:
  - url: /api
paths:
  /auth/login:
    post:
      summary: User login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                password:
                  type: string
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                  user:
                    $ref: '#/components/schemas/User'
  /auth/forgot-password:
    post:
      summary: Request password reset
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
      responses:
        '200':
          description: Reset email sent
  /auth/reset-password:
    post:
      summary: Reset password
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                token:
                  type: string
                newPassword:
                  type: string
      responses:
        '200':
          description: Password reset successful
  /admin/invites:
    post:
      summary: Create invite
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                role:
                  type: string
                  enum: [MEMBER, STAFF, ADMIN]
                unitId:
                  type: string
      responses:
        '200':
          description: Invite created
          content:
            application/json:
              schema:
                type: object
                properties:
                  inviteLink:
                    type: string
                  expiresAt:
                    type: string
                    format: date-time
  /invites/{token}:
    get:
      summary: Validate invite token
      parameters:
        - name: token
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Invite valid
          content:
            application/json:
              schema:
                type: object
                properties:
                  email:
                    type: string
                  role:
                    type: string
                  unitId:
                    type: string
                  expiresAt:
                    type: string
                    format: date-time
  /invites/{token}/accept:
    post:
      summary: Accept invite
      parameters:
        - name: token
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                password:
                  type: string
      responses:
        '200':
          description: Invite accepted
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                  user:
                    $ref: '#/components/schemas/User'
  /content:
    get:
      summary: List content
      parameters:
        - name: type
          in: query
          schema:
            type: string
        - name: limit
          in: query
          schema:
            type: integer
        - name: offset
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: List of content items
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Content'
  /content/{id}:
    get:
      summary: Get content item
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Content item
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Content'
  /admin/content:
    post:
      summary: Create content
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ContentInput'
      responses:
        '200':
          description: Content created
  /admin/content/{id}:
    put:
      summary: Update content
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ContentInput'
      responses:
        '200':
          description: Content updated
    delete:
      summary: Delete content
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Content deleted
  /admin/content/{id}/status:
    patch:
      summary: Update content status
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum: [PUBLISHED, ARCHIVED]
      responses:
        '200':
          description: Status updated
  /admin/content/{id}/pin:
    patch:
      summary: Pin content
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                isPinned:
                  type: boolean
      responses:
        '200':
          description: Pin status updated
  /events:
    get:
      summary: List events
      responses:
        '200':
          description: List of events
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Event'
  /admin/events/{id}/tickets:
    post:
      summary: Issue tickets
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                userIds:
                  type: array
                  items:
                    type: integer
      responses:
        '200':
          description: Tickets issued
  /tickets/my-tickets:
    get:
      summary: Get my tickets
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of tickets
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Ticket'
  /staff/check-in:
    post:
      summary: Check-in a ticket
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                ticketToken:
                  type: string
                eventId:
                  type: integer
      responses:
        '200':
          description: Check-in successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  memberName:
                    type: string
  /billing/my-statements:
    get:
      summary: Get my billing statements
      security:
        - bearerAuth: []
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
        - name: offset
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: List of statements
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/BillingStatement'
  /billing/download/{id}:
    get:
      summary: Download billing statement
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: PDF file
          content:
            application/pdf:
              schema:
                type: string
                format: binary
  /admin/billing/upload:
    post:
      summary: Upload billing statement
      security:
        - bearerAuth: []
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                userId:
                  type: integer
                period:
                  type: string
                  format: date
      responses:
        '200':
          description: Upload successful
  /admin/billing/bulk-upload:
    post:
      summary: Bulk upload billing statements
      security:
        - bearerAuth: []
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '200':
          description: Bulk upload result
          content:
            application/json:
              schema:
                type: object
                properties:
                  total:
                    type: integer
                  success:
                    type: integer
                  failures:
                    type: array
                    items:
                      type: object
                      properties:
                        file:
                          type: string
                        error:
                          type: string
                  results:
                    type: array
                    items:
                      type: object
                      properties:
                        file:
                          type: string
                        userId:
                          type: integer
                        unitId:
                          type: string
                        period:
                          type: string
                        status:
                          type: string
                          enum: [SUCCESS, FAILED]
                        error:
                          type: string

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
        email:
          type: string
        role:
          type: string
          enum: [MEMBER, ADMIN, STAFF]
        unitId:
          type: string
    Content:
      type: object
      properties:
        id:
          type: integer
        type:
          type: string
          enum: [ANNOUNCEMENT, ACTIVITY, MEMO, EVENT]
        title:
          type: string
        body:
          type: string
        status:
          type: string
          enum: [DRAFT, PUBLISHED, ARCHIVED]
        visibility:
          type: string
          enum: [PUBLIC, MEMBER]
        isPinned:
          type: boolean
        createdAt:
          type: string
          format: date-time
        publishedAt:
          type: string
          format: date-time
    ContentInput:
      type: object
      properties:
        type:
          type: string
          enum: [ANNOUNCEMENT, ACTIVITY, MEMO, EVENT]
        title:
          type: string
        body:
          type: string
        visibility:
          type: string
          enum: [PUBLIC, MEMBER]
    Event:
      allOf:
        - $ref: '#/components/schemas/Content'
        - type: object
          properties:
            startAt:
              type: string
              format: date-time
            endAt:
              type: string
              format: date-time
            location:
              type: string
    Ticket:
      type: object
      properties:
        id:
          type: integer
        eventId:
          type: integer
        codeHash:
          type: string
        checkedInAt:
          type: string
          format: date-time
    BillingStatement:
      type: object
      properties:
        id:
          type: integer
        period:
          type: string
          format: date
        createdAt:
          type: string
          format: date-time
